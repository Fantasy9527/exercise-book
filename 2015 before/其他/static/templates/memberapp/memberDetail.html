<div ng-show="showAlert==1" class="alert alert-success fadeInLeft animation-delay1" style="font-size: 11px;width:100%; position: fixed;z-index:9999;top:45px" ng-class="{'modal-open':modalOpen}"><span>会员卡已{{warnInfo}}</span></div>
<div id="isEditAlert" ng-show="showEditAlert==1" class="alert alert-success fadeInLeft animation-delay1" style="font-size: 11px;width:100%; position: fixed;z-index:9999;top:45px"><span>会员信息已保存</span></div>

<div class="panel-tab clearfix">
    <ul class="nav nav-tabs">
        <li class="active">
            <a href="#/memberDetail/{{memberId}}">
                <i class="fa fa-user"></i> 基本资料
            </a>
        </li>
        <li>
            <a href="#/expenseRecord/{{memberId}}">
                <i class="fa fa-edit"></i> 消费记录
            </a>
        </li>
        <li>
            <a href="#/chargeRecord/{{memberId}}">
                <i class="fa fa-tasks"></i> 充值记录
            </a>
        </li>
        <li>
            <a href="#/hanginAccount/{{memberId}}">
                <i class="fa fa-pencil fa-lg"></i> 挂账结算
            </a>
        </li>
        <li>
            <a href="#/putUpRecord/{{memberId}}">
                <i class="fa fa-bookmark fa-lg"></i> 挂单记录
            </a>
        </li>
    </ul>
</div>
<div class="panel-body">
    <form ng-submit="saveModel()" name="myForm">
        <table class="table table-bordered table-condensed table-hover table-striped">

            <body>
                <tr ng-if="isEdit==-1">
                    <td style="width:15%;"><label>会员姓名</label></td>
                    <td style="width:35%;"><span ng-bind="model.name"></span></td>
                    <td style="width:15%;"><label>性别</label></td>
                    <td style="width:35%;"><span ng-bind="model.sex"></span></td>
                </tr>
                <tr ng-if="isEdit==1">
                    <td style="width:15%;"><label>会员姓名</label></td>
                    <td style="width:35%;">
                        <div style="width:180px;" ng-class='{"has-error":myForm.name.$invalid && myForm.name.$dirty}'>
                            <input type="text" placeholder="会员姓名" class="form-control input-sm" ng-model="editModel.name" name="name" maxlength="10" required>
                            <div class="error" ng-show="(editModel.name==undefined || editModel.name.length==0) && myForm.name.$error.required==true" style="color:#bb4442;"><small>会员姓名不能为空</small></div>
                        </div>
                    </td>
                    <td style="width:15%;"><label>性别</label></td>
                    <td style="width:35%;">
                        <select style="width:180px;" class="form-control input-sm" ng-model="editModel.sex" ng-options="p as p for p in sexes"></select>
                    </td>
                </tr>
                <tr ng-if="isEdit==-1">
                    <td style="width:15%;">
                        <label>会员卡号</label>
                    </td>
                    <td style="width:35%;"><span>{{model.card_no}}</span></td>
                    <td style="width:15%;">
                        <label>会员卡RFID</label>
                    </td>
                    <td style="width:35%;"><span>{{model.rfid}}</span></td>
                </tr>
                <tr ng-if="isEdit==1">
                    <td style="width:15%;">
                        <label>会员卡号</label>
                    </td>
                    <td style="width:35%;">
                        <div style="width:180px;" ng-class='{"has-error":myForm.card_no.$invalid && myForm.card_no.$dirty}'>
                            <input type="text" placeholder="会员卡号" class="form-control input-sm" ng-model="editModel.card_no" name="card_no" ng-pattern="/^[0-9a-zA-Z]*$/" required>
                            <div class="error" ng-show="(editModel.card_no==undefined || editModel.card_no.length==0) && myForm.card_no.$error.required==true" style="color:#bb4442;"><small>会员卡号不能为空</small></div>
                            <div class="error" ng-show="myForm.card_no.$invalid && myForm.card_no.$dirty && myForm.card_no.$error.required==undefined" style="color:#bb4442;"><small>会员卡号必须是数字或字母</small></div>
                        </div>
                    </td>
                    <td style="width:15%;">
                        <label>会员卡RFID</label>
                    </td>
                    <td style="width:35%;">
                        <div style="width:180px;" ng-class='{"has-error":myForm.rfid.$invalid && myForm.rfid.$dirty}'>
                            <input type="text" placeholder="会员卡RFID" class="form-control input-sm" ng-model="editModel.rfid" name="rfid" ng-pattern="/^[0-9a-zA-Z]*$/">
                            <div class="error" ng-show="myForm.rfid.$invalid && myForm.rfid.$dirty && myForm.rfid.$error.required==undefined" style="color:#bb4442;"><small>会员卡RFID必须是数字或字母</small></div>
                        </div>
                    </td>
                </tr>
                <tr ng-if="isEdit==-1">
                    <td style="width:15%;"><label>会员类型</label></td>
                    <td style="width:35%;"><span>{{model.memberTypeName}}</span></td>
                    <td style="width:15%;"><label>手机号码</label></td>
                    <td style="width:35%;"><span>{{model.mobile}}</span></td>
                </tr>
                <tr ng-if="isEdit==1">
                    <td style="width:15%;"><label>会员类型</label></td>
                    <td style="width:35%;">
                        <!--<select style="width:180px;" class="form-control input-sm" ng-model="editModel.memberType" ng-options="m.id as m.name for m in memberTypes"></select>-->
                        <span>{{model.memberTypeName}}</span>
                    </td>
                    <td style="width:15%;"><label>手机号码</label></td>
                    <td style="width:35%;">
                        <div ng-class='{"has-error":myForm.mobile.$invalid && myForm.mobile.$dirty}'>
                            <input type="text" style="width:180px;" placeholder="手机号码" class="form-control input-sm" ng-model="editModel.mobile" name="mobile" ng-pattern="/^[0-9]*$/" required>
                            <div class="error" ng-show="(editModel.mobile==undefined || editModel.mobile.length==0) && myForm.mobile.$error.required==true" style="color:#bb4442;"><small>手机号码不能为空</small></div>
                            <div class="error" ng-show="myForm.mobile.$invalid && myForm.mobile.$dirty && myForm.mobile.$error.required==undefined" style="color:#bb4442;"><small>手机号码必须是数字</small></div>
                        </div>
                    </td>
                </tr>
                <tr ng-if="isEdit==-1">
                    <td style="width:15%;"><label>证件类型</label></td>
                    <td style="width:35%;"><span>{{model.identTypeName}}</span></td>
                    <td style="width:15%;"><label>证件号码</label></td>
                    <td style="width:35%;"><span>{{model.id_no}}</span></td>
                </tr>
                <tr ng-if="isEdit==1">
                    <td style="width:15%;"><label>证件类型</label></td>
                    <td style="width:35%;">
                        <select style="width:180px;" class="form-control input-sm" ng-model="editModel.identType" ng-options="p.id as p.name for p in identTypes"></select>
                    </td>
                    <td style="width:15%;"><label>证件号码</label></td>
                    <td style="width:35%;">
                        <div ng-class='{"has-error":myForm.id_no.$invalid && myForm.id_no.$dirty}'>
                            <input type="text" placeholder="证件号码" style="width:180px;" name="id_no" class="form-control input-sm" ng-model="editModel.id_no" ng-pattern="/^[0-9a-zA-Z]*$/">
                            <div class="error" ng-show="myForm.id_no.$invalid && myForm.id_no.$dirty && myForm.id_no.$error.required==undefined" style="color:#bb4442;"><small>证件号码必须是数字或字母</small></div>
                        </div>
                    </td>
                </tr>
                <tr ng-if="isEdit==-1">
                    <td style="width:15%;"><label>出生年月</label></td>
                    <td style="width:35%;"><span>{{model.birthday}}</span></td>
                    <td style="width:15%;"><label>邮箱</label></td>
                    <td style="width:35%;"><span>{{model.email}}</span></td>
                </tr>
                <tr ng-show="isEdit==1">
                    <td style="width:15%;"><label>出生年月</label></td>
                    <td style="width:35%;">
                        <div ng-class='{"has-error":myForm.birthday.$invalid && myForm.birthday.$dirty}'>
                            <input style="width:180px;" ng-model="editModel.birthday" class="form-control datepicker datepickerTime
                             time-cursor-pointer" type="text" placeholder="出生年月" data-date-picktime="false" data-date-language="zh-cn" data-date-showtoday="true" datepicker-dir readonly>
                            <div class="error" ng-show="myForm.birthday.$invalid && myForm.birthday.$dirty" style="color:#bb4442;"><small>请输入正确的日期格式</small></div>
                        </div>
                    </td>
                    <td style="width:15%;"><label>邮箱</label></td>
                    <td style="width:35%;">
                        <input type="text" placeholder="邮箱" style="width:180px;" name="email" class="form-control input-sm" ng-model="editModel.email" ng-pattern="/^(\w)+(\.\w+)*@(\w)+((\.\w{2,3}){1,3})$/">
                        <div class="error" ng-show="myForm.email.$invalid && myForm.email.$dirty && myForm.email.$error.required==undefined" style="color:#bb4442;"><small>邮箱格式不正确</small></div>
                    </td>
                </tr>
                <tr>
                    <td style="width:15%;"><label>营销员</label></td>
                    <td colspan="3"><span>{{model.sale_staff}}</span></td>
                </tr>
                <tr><td colspan="4" align="center"><label></label></td></tr>
                <tr>
                    <td style="width:15%;">
                        <label>卡余额</label>
                    </td>
                    <td>
                        <span style="color:red;">{{model.total_balance}}</span><span style="margin-left:4px;">(充值余额: {{model.charge_balance}}</span><span style="margin-left:4px;">赠送余额: {{model.gift_balance}})</span>
                        <a class="pull-right btn btn-sm btn-success" ng-click="balanceChange()">余额调整</a>
                    </td>
                </tr>
                <tr>
                    <td style="width:15%;">
                        <label>积分</label>
                    </td>
                    <td style="width:35%;"><span style="color:red;">{{model.point}}</span>
                        <a class="pull-right btn btn-sm btn-info" ng-click="pointOpen()">积分调整</a>
                    </td>
                </tr>
                <tr>
                    <td style="width:15%;">
                        <label>押金</label>
                    </td>
                    <td style="width:35%;"><span style="color:red;">{{model.deposit}}</span></td>
                </tr>
                <tr>
                    <td colspan="4">
                        <label></label>
                    </td>
                </tr>
                <tr>
                    <td style="width:15%;">
                        <label>有效期</label>
                    </td>
                    <td colspan="3">
                        <div style="float: left;" ng-class="{'margin-top-6': isEdit == 1}">{{model.create_on}} - </div>
                        <div style="float: left;" ng-if="isEdit==-1">{{model.end_time}}</div>
                        <div style="float: left; margin-left: 5px;" ng-show="isEdit==1" ng-class='{"has-error":myForm.end_time.$invalid && myForm.end_time.$dirty}'>
                            <input style="width:180px;" ng-model="editModel.end_time" class="form-control datepicker datepickerTime
                             time-cursor-pointer" type="text" placeholder="出生年月" data-date-picktime="false" data-date-language="zh-cn" data-date-showtoday="true" datepicker-dir readonly required>
                            <div class="error" ng-show="myForm.end_time.$invalid && myForm.end_time.$dirty" style="color:#bb4442;"><small>请输入正确的日期格式</small></div>
                        </div>
                    </td>
                </tr>
            <tbody>
        </table>
        <div>
            <input ng-show="isEdit==1" type="submit" class="btn btn-sm btn-success" ng-disabled="myForm.$invalid" value="保存">
            <a ng-show="isEdit==1" type="button" class="btn btn-sm btn-danger" ng-click="hideEdit()">  取消</a>
            <a ng-show="isEdit==-1 && model.state!=2" type="button" class="btn btn-sm btn-success" ng-click="editMember()"><i class="fa fa-edit fa-lg"></i>  编辑</a>
            <a ng-show="isEdit==-1 && model.state==2" type="button" class="btn btn-sm btn-success" ng-click="changeMemberState(1)"><i class="fa fa-wrench fa-lg"></i> 再次启用</a>
            <a ng-show="isEdit==-1 && model.state!=2" type="button" class="btn btn-sm btn-danger" ng-click="changeMemberState(2)"><i class="fa fa-square-o fa-lg"></i>   停用</a>
        </div>
    </form>
    <!-- 遮罩层 -->
    <div class="modal-backdrop" ng-show="modalOpen" ng-class="{'in':modalOpen,fade:modalOpen}"></div>
    <div class="modal fade" style="display:block" ng-show="modalOpen" ng-class="{'modal-open':modalOpen,'in':modalOpen}">
        <div class="modal-dialog">
            <div class="modal-content">
            <!-- 选择方式 -->
                <div ng-show="changeBtnShow">
                    <div class="modal-header">
                        <button type="button" class="close" ng-click="closeModel()">×</button>
                        <h4>调整余额</h4>
                    </div>
                    <div class="modal-body">
                        <!-- 充值 -->
                        <div>
                            <a class="btn btn-success block" ng-click="recharge()">充值</a>
                            <div class="seperator"></div>
                            <a class="btn btn-danger block" ng-click="withhold()">扣款</a>
                        </div>
                    </div>
                </div>
                <!-- 充值输入框 -->
                <div ng-hide="changeBtnShow">
                    <div class="modal-header">
                        <button type="button" class="close" ng-click="closeModel()">×</button>
                        <h4 ng-show="isRecharge">充值</h4>
                        <h4 ng-hide="isRecharge">扣款</h4>
                    </div>
                    <div class="modal-body">
                        <!-- 充值 -->
                        <form name="chargeForm" novalidate>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>充值账户:<span class="parsley-error" ng-show="chargeForm.chargeChangeValue.$invalid">(必须是保留两位小数的正实数)</span></label>
                                        <input type="text" class="form-control input-sm" placeholder="不调整" ng-class="{'parsley-error':chargeForm.chargeChangeValue.$invalid}" name="chargeChangeValue" ng-model="chargeChangeValue" ng-pattern="/^[0-9]+(.[0-9]{2})?$/">
                                        <label>初始余额:{{model.charge_balance}} </label>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>赠送余额: <span class="parsley-error" ng-show="chargeForm.giftChangeValue.$invalid">(必须是保留两位小数的正实数)</span></label>
                                        <input type="text" class="form-control input-sm" placeholder ="不调整" ng-class="{'parsley-error':chargeForm.giftChangeValue.$invalid}" name="giftChangeValue" ng-model="giftChangeValue" ng-pattern="/^[0-9]+(.[0-9]{2})?$/">
                                        <label>初始余额:{{model.gift_balance}}</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>备注(必填)</label>
                                <textarea class="form-control" rows="3" ng-model="changeRemark"></textarea>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer"  ng-hide="changeBtnShow">
                    <button class="btn btn-default btn-sm" ng-hide="isRecharge" ng-hide="" ng-click="recharge()">切换到充值</button>
                    <button class="btn btn-default btn-sm" ng-show="isRecharge" ng-click="withhold()">切换到扣款</button>
                    <button class="btn btn-danger btn-sm" ng-click="closeModel()">取消</button>
                    <button href="#" class="btn btn-success  btn-sm" ng-hide="changeBtnShow" ng-click="changeBalance('isChargeChange')" ng-disabled="chargeForm.$invalid">确定</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 积分调整 -->
    <div class="modal-backdrop fade" ng-show="pointModalOpen" ng-class="{'in':pointModalOpen}"></div>
    <div class="modal fade" style="display:block" ng-show="pointModalOpen" ng-class="{'modal-open':pointModalOpen,'in':pointModalOpen}">
        <div class="modal-dialog">
            <div class="modal-content">
                <div ng-show="changeBtnShow">
                    <div class="modal-header">
                        <button type="button" class="close" ng-click="closeModel()">×</button>
                        <h4>调整积分</h4>
                    </div>
                    <div class="modal-body">
                        <div>
                            <a class="btn btn-success block" ng-click="recharge()">调增</a>
                            <div class="seperator"></div>
                            <a class="btn btn-danger block" ng-click="withhold()">调减</a>
                        </div>
                    </div>
                </div>
                <div>
                    <!-- 充值 -->
                    <div ng-hide="changeBtnShow">
                        <div class="modal-header">
                            <button type="button" class="close" ng-click="closeModel()">×</button>
                            <h4 ng-show="isRecharge">调增</h4>
                            <h4 ng-hide="isRecharge">调减</h4>
                        </div>
                        <div class="modal-body">
                            <form name="pointForm">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>积分账户:<span class="parsley-error"  ng-show="!pointForm.pointChangeValue.$pristine&&pointForm.pointChangeValue.$invalid">(必须是保留两位小数的正实数)</span></label>
                                            <input type="text" class="form-control input-sm" placeholder="不调整" name="pointChangeValue" required ng-class="{'parsley-error':!pointForm.pointChangeValue.$pristine&&pointForm.pointChangeValue.$invalid}" ng-model="pointChangeValue" ng-pattern="/^[0-9]+(.[0-9]{2})?$/">
                                            <label>积分余额:{{model.point}}</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>备注(必填)</label>
                                    <textarea class="form-control" rows="3" ng-model="changeRemark"></textarea>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer"  ng-hide="changeBtnShow">
                    <button class="btn btn-default btn-sm" ng-hide="isRecharge" ng-click="recharge()">切换到调增</button>
                    <button class="btn btn-default btn-sm" ng-show="isRecharge" ng-click="withhold()">切换到调减</button>
                    <button class="btn btn-danger btn-sm" ng-click="closeModel()">取消</button>
                    <button href="#" class="btn btn-success  btn-sm" type="submit" ng-hide="changeBtnShow" ng-click="changeBalance('isPointChange')" ng-disabled="pointForm.$invalid">确定</button>
                </div>
            </div>
        </div>
    </div>
</div>
